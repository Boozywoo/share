{"version":3,"names":[],"mappings":"","sources":["app.js"],"sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n'use strict';\n\nvar _custom = require('./custom');\n\nvar custom = _interopRequireWildcard(_custom);\n\nvar _profile = require('./pages/profile');\n\nvar profile = _interopRequireWildcard(_profile);\n\nvar _schedule = require('./pages/schedule');\n\nvar schedule = _interopRequireWildcard(_schedule);\n\nvar _order = require('./pages/order');\n\nvar order = _interopRequireWildcard(_order);\n\nvar _home = require('./pages/home');\n\nvar home = _interopRequireWildcard(_home);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\n},{\"./custom\":2,\"./pages/home\":3,\"./pages/order\":4,\"./pages/profile\":5,\"./pages/schedule\":6}],2:[function(require,module,exports){\n'use strict';\n\n$.ajaxSetup({\n    headers: {\n        'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n    }\n});\n\n$(document).on('submit', '.js_ajax-form', submitAjaxForm);\n\nwindow.processAjaxSubmit = function ($form, onSuccess, onError) {\n    return function (response) {\n        $form.trigger('form-ajax', [response]);\n        if (response.result == 'success') {\n            $form.trigger('form-ajax-success', [response]);\n            if (response.message) toastr.success(response.message);\n            if (response.redirect) setTimeout(function () {\n                return window.location.href = response.redirect;\n            }, 0);\n            if ($form.hasClass('js_form-step-order')) {\n                setTimeout(function () {\n                    return window.location.href = '/order';\n                }, 0);\n            };\n        } else {\n            $form.trigger('form-ajax-error', [response]);\n            toastr.error(response.message || 'Ошибка при отправке формы!');\n        }\n        $form.find('input[type=\"submit\"]').attr('disabled', false);\n        $form.find('.js_btn').attr('disabled', false);\n    };\n};\n\nfunction submitAjaxForm() {\n    var $form = $(this);\n    $form.find('input[type=\"submit\"]').attr('disabled', true);\n    $form.find('.js_btn').attr('disabled', true);\n    $form.ajaxSubmit({\n        data: { 'is_ajax': 1 },\n        success: window.processAjaxSubmit($form)\n    });\n    return false;\n}\n\nfunction init() {\n    maskPhone();\n}\n\ninit();\n\nfunction maskPhone() {\n    // $('.js_mask-phone').inputmask('+375 (99) 999-99-99');\n}\n\nfunction datePicker() {\n    $.fn.datepicker.dates['ru'] = {\n        days: [\"Воскресенье\", \"Понедельник\", \"Вторник\", \"Среда\", \"Четверг\", \"Пятница\", \"Суббота\"],\n        daysShort: [\"Вск\", \"Пнд\", \"Втр\", \"Срд\", \"Чтв\", \"Птн\", \"Суб\"],\n        daysMin: [\"Вс\", \"Пн\", \"Вт\", \"Ср\", \"Чт\", \"Пт\", \"Сб\"],\n        months: [\"Январь\", \"Февраль\", \"Март\", \"Апрель\", \"Май\", \"Июнь\", \"Июль\", \"Август\", \"Сентябрь\", \"Октябрь\", \"Ноябрь\", \"Декабрь\"],\n        monthsShort: [\"Янв\", \"Фев\", \"Мар\", \"Апр\", \"Май\", \"Июн\", \"Июл\", \"Авг\", \"Сен\", \"Окт\", \"Ноя\", \"Дек\"],\n        today: \"Сегодня\",\n        clear: \"Очистить\",\n        format: \"dd.mm.yyyy\",\n        weekStart: 1\n    };\n    $('.js_date-pick').datepicker({\n        format: \"dd.mm.yyyy\",\n        todayHighlight: true,\n        autoclose: true,\n        language: 'ru'\n    });\n    $('.js_datepicker').datepicker({\n        format: \"dd.mm.yyyy\",\n        todayHighlight: true,\n        autoclose: true,\n        language: 'ru'\n    });\n}\n\nwindow.datePicker = datePicker;\n\ndatePicker();\n\n},{}],3:[function(require,module,exports){\n'use strict';\n\n$(document).on('click', '.reservatButon', changeDate);\n// $(document).on('change', '.js_reservation-station-from', changeStationFrom)\n$(document).on('change', '.js_city_from_id', changeCityFrom);\n$(document).on('change', '.js_city_to_id', changeCityTo);\n//$(document).on('change', '.js_reservation-station-to', checkStateButtonDisabled)\n// $(document).on('change', '.js_reservation-station-to', changeStationTo)\n// $(document).on('change', '.js_reservation-route', changeRoute)\n$(document).on('click', '.js_reservation-button', clickButton2);\n$(document).on('click', '.js_reservation-return-button', reservationReturn);\n$(document).on('ready', changeImg);\n$(document).on('change', '.js_city_to_id', disableDates);\n\nfunction changeImg() {\n    $.get(\"/get-rand-img\").done(function (data) {\n        if (data !== null) {\n            if (window.matchMedia(\"(max-width: 767px)\").matches) {\n                $('body.mainPage, body.index, body.personalCabinet, body.about').css('background-image', 'url(/public/assets/index/images/for_clients/' + data[1] + ')');\n            } else {\n                $('body.mainPage, body.index, body.personalCabinet, body.about').css('background-image', 'url(/public/assets/index/images/for_clients/' + data[0] + ')');\n            }\n        }\n    });\n}\n\n// Автоприменение формы, свели перешли из iframe\n(function () {\n    var $form = document.querySelector('form#reservations');\n    var $from = document.querySelector('.js_city_from_id');\n    var $to = document.querySelector('.js_city_to_id');\n    var $date = document.querySelector('.js_date-pick');\n    var $return_flag = document.querySelector('#return_flag');\n    var params = {};\n\n    if (isAllElementsExists()) {\n        init();\n    }\n\n    function isAllElementsExists() {\n        return $form && $from && $to && $date;\n    }\n\n    function init() {\n        setParams();\n\n        if (isQueryValid()) {\n            setForm();\n        }\n    }\n\n    function setParams() {\n        var url = location.href;\n        url = url.split('?');\n\n        if (url[1]) {\n            var query = url[1].split('&');\n\n            for (var i = 0; i < query.length; i++) {\n                var pair = query[i].split('=');\n                if (pair[1]) {\n                    params[pair[0]] = pair[1];\n                }\n            }\n        }\n    }\n\n    function setForm() {\n        $date.value = params.date;\n\n        var date = $($date).val();\n        var $bts = $($date).closest('form').find('.reservatButon');\n        $bts.removeClass('active');\n        var $btn = $bts.filter('[data-val=\"' + date + '\"]');\n        if ($btn.length) $btn.addClass('active');\n\n        $from.value = params.from;\n        params.return_flag ? $return_flag.value = params.return_flag : $return_flag = null;\n\n        var url = $($from).data().url;\n        var station_url = $($from).data().station_url;\n        var value = $($from).val();\n\n        $(\".js_city_to_id option\").remove();\n        $('.js_city_to_id').prop('disabled', false);\n        $(\".js_reservation-station-from option\").remove();\n        $('.js_reservation-station-from').append($('<option>', {\n            value: 0,\n            text: 'Место посадки (Откуда)'\n        }));\n\n        $(\".js_reservation-station-to option\").remove();\n        $('.js_reservation-station-to').append($('<option>', {\n            value: 0,\n            text: 'Место высадки (Куда)'\n        }));\n\n        $.get(url + '?city_from_id=' + value, function (response) {\n            $('.js_city_to_id').append($('<option>', {\n                value: 0,\n                text: 'Куда'\n            }));\n            for (var key in response) {\n                $('.js_city_to_id').append($('<option>', {\n                    value: response[key].id,\n                    text: response[key].name\n                }));\n            }\n\n            $to.value = params.to;\n\n            changeCityTo();\n\n            clickButton2();\n        });\n    }\n\n    function isQueryValid() {\n        return params.from_embed_form == 1 && params.from.match(/\\d+/) && params.to.match(/\\d+/) && params.date.match(/\\d{2}.\\d{2}.\\d{4}/) && (params.return_flag ? params.return_flag.match(/\\d{1}/) : true);\n    }\n})();\n\nfunction changeCityFrom() {\n    var _this = this;\n\n    $('.city_to_id').hide();\n    $('.js_bus-overlay.js_city_to').show();\n\n    var url = $(this).data().url;\n    var station_url = $(this).data().station_url;\n    var value = $(this).val();\n    $(\".js_city_to_id option\").remove();\n    $('.js_city_to_id').prop('disabled', false);\n    $(\".js_reservation-station-from option\").remove();\n    $('.js_reservation-station-from').append($('<option>', {\n        value: 0,\n        text: 'Место посадки (Откуда)'\n    }));\n\n    $(\".js_reservation-station-to option\").remove();\n    $('.js_reservation-station-to').append($('<option>', {\n        value: 0,\n        text: 'Место высадки (Куда)'\n    }));\n\n    $.get(url + '?city_from_id=' + value, function (response) {\n        $('.js_city_to_id').append($('<option>', {\n            value: 0,\n            text: 'Куда'\n        }));\n        for (var key in response) {\n            $('.js_city_to_id').append($('<option>', {\n                value: response[key].id,\n                text: response[key].name\n            }));\n        }\n\n        if ($('.js_city_to_id') && $('.js_city_to_id').val() && $('#return_flag')) {\n            if (parseInt($('#city_to_id').val()) > 0 && $('#city_from_id').val()) {\n                $('#return-from').val($(\"#city_to_id option:selected\").text());\n                $('#return_city_from_id').val($(\"#city_to_id\").val());\n\n                disableDates();\n            }\n\n            if ($('#return_flag').val() == 1) {\n                $('.js-return-ticket, .scheduleBlockReturn').fadeToggle();\n                $('.reservRound').eq(0).text(_this.checked ? 'Туда' : 'Бронь');\n\n                if ($('#return-from').val() && $('#return-to').val()) {\n                    reservationReturn();\n                }\n            }\n        }\n\n        $('.js_bus-overlay.js_city_to').hide();\n        $('.city_to_id').show();\n    });\n}\n\nfunction changeCityTo() {\n    var button = $('.js_reservation-button');\n    button.attr('disabled', false);\n\n    /*$.get(get_route_url + '?from_city_id=' + from_city_id + '&to_city_id=' + to_city_id, (response) => {\n        $( \"input[name='route_id']\").val(response.route_id);\n    $(\".js_reservation-station-from option\").remove();\n    for (var key in response.from_stations) {\n        $('.js_reservation-station-from').append($('<option>', {\n            value: response.from_stations[key].id,\n            text: response.from_stations[key].name\n        }));\n    }\n    $(\".js_reservation-station-to option\").remove();\n    for (var key in response.to_stations) {\n        $('.js_reservation-station-to').append($('<option>', {\n            value: response.to_stations[key].id,\n            text: response.to_stations[key].name\n        }));\n    }\n    });*/\n}\n\nfunction setStations(js_class, url, city_id) {\n    $(\".\" + js_class + \" option\").remove();\n    $.get(url + '?city_id=' + city_id, function (response) {\n        for (var key in response) {\n            $('.' + js_class).append($('<option>', {\n                value: response[key].id,\n                text: response[key].name\n            }));\n        }\n    });\n}\n\nfunction clickButton() {\n    if ($('.js_reservation-button').attr('disabled')) {\n        toastr.error('Выберите места посадки и высадки');\n    } else {\n        var url = $('.js_reservation-button').attr('data-url') + '?' + $('.js_reservation-button').closest('form').serialize();\n        var show_schedule = $('.scheduleBlock');\n        $.get(url, function (response) {\n            show_schedule.html(response);\n        });\n    }\n    return false;\n}\n\nfunction clickButton2() {\n    if ($('.js_reservation-button').attr('disabled')) {\n        toastr.error('Выберите города посадки и высадки');\n    } else {\n        var $embedForm = document.querySelector('.js-embed-form');\n\n        if ($embedForm) {\n            if (typeof sendEmbedReservationForm === \"function\") {\n                sendEmbedReservationForm();\n            }\n        } else {\n            showTours();\n        }\n    }\n    return false;\n}\n\nfunction showTours() {\n    $('.scheduleBlock').html('');\n    $('.sk-fading-circle.first').show();\n    var url = $('.js_reservation-button').attr('data-url') + '?' + $('.js_reservation-button').closest('form').serialize();\n    var show_schedule = $('.scheduleBlock');\n    $.get(url, function (response) {\n        $('.sk-fading-circle.first').hide();\n        if (response.result == 'success') {\n            if (show_schedule.length) {\n                show_schedule.html(response.html);\n                $('html, body').animate({\n                    scrollTop: show_schedule.offset().top\n                }, 300);\n            }\n        } else {\n            toastr.error(response.message);\n        }\n    });\n}\n\nfunction reservationReturn() {\n    if (!$('#return_city_to_id').val() || !$('#return_city_from_id').val()) {\n        toastr.error('Выберите города посадки и высадки');\n    } else {\n        $('.scheduleBlockReturn').html('');\n        $('.sk-fading-circle.second').show();\n        var url = $('.js_reservation-button').attr('data-url') + '?' + $('.js_reservation-return-button').closest('form').serialize();\n        var show_schedule = $('.scheduleBlockReturn');\n        $.get(url, function (response) {\n            $('.sk-fading-circle.second').hide();\n            if (response.result == 'success') {\n                show_schedule.html(response.html);\n                $('html, body').animate({\n                    scrollTop: show_schedule.offset().top\n                }, 300);\n                show_schedule.prepend('<input type=\"hidden\" class=\"return-form\" value=\"1\"/>');\n            } else {\n                toastr.error(response.message);\n            }\n        });\n    }\n    return false;\n}\n\nfunction changeRoute() {\n    var routeId = $(this).val();\n    if ($(this).val()) {\n        $.post('/stations?route_id=' + routeId, function (response) {\n            if (response.result = 'success') {\n                var $stationFrom = $('.js_reservation-station-from');\n                $stationFrom.find('option').not(':first').remove();\n                $.each(response.stations, function (index, value) {\n                    if (index == 0) {\n                        $stationFrom.append('<option selected value=\"' + value.station_id + '\">' + value.name + '</option>');\n                        var $stationTo = $('.js_reservation-station-to');\n                        $stationTo.attr('disabled', true);\n                        $.post('/stations?route_id=' + routeId + '&station_from_id=' + value.station_id, function (response) {\n                            if (response.result = 'success') {\n                                $stationTo.find('option').not(':first').remove();\n                                length = response.stations.length;\n                                $.each(response.stations, function (index, value) {\n                                    if (index === length - 1) $stationTo.append('<option selected value=\"' + value.station_id + '\">' + value.name + '</option>');else $stationTo.append('<option value=\"' + value.station_id + '\">' + value.name + '</option>');\n                                });\n                            }\n                        });\n                        checkStateStationToDisabled();\n                        checkStateButtonDisabled();\n                    } else $stationFrom.append('<option value=\"' + value.station_id + '\">' + value.name + '</option>');\n                });\n                checkStateStationToDisabled();\n                checkStateButtonDisabled();\n                $('.scheduleBlock').html('');\n                return;\n            }\n        });\n    }\n    $('.scheduleBlock').html('');\n    checkStateStationToDisabled();\n    checkStateButtonDisabled();\n}\n\nfunction changeStationFrom() {\n    var $stationTo = $('.js_reservation-station-to');\n    $stationTo.attr('disabled', true);\n    var routeId = $('.js_reservation-route').val();\n    var stationFromId = $(this).val();\n    if (stationFromId) {\n        $.post('/stations?route_id=' + routeId + '&station_from_id=' + stationFromId, function (response) {\n            if (response.result = 'success') {\n                $stationTo.find('option').not(':first').remove();\n\n                length = response.stations.length;\n                $.each(response.stations, function (index, value) {\n                    if (index === length - 1) $stationTo.append('<option selected value=\"' + value.station_id + '\">' + value.name + '</option>');else $stationTo.append('<option value=\"' + value.station_id + '\">' + value.name + '</option>');\n                });\n                checkStateStationToDisabled();\n                checkStateButtonDisabled();\n                setTimeout(clickButton, 900);\n                return;\n            }\n        });\n    }\n    checkStateStationToDisabled();\n    checkStateButtonDisabled();\n}\n\nfunction checkStateStationToDisabled() {\n    var $stationTo = $('.js_reservation-station-to');\n    var disabled = true;\n    if ($('.js_reservation-station-from').val()) {\n        disabled = false;\n    } else {\n        $stationTo.find('option').not(':first').remove();\n    }\n    $stationTo.attr('disabled', disabled);\n}\n\nfunction checkStateButtonDisabled() {\n    var disabled = true;\n    if ($('.js_reservation-station-to').val() && $('.js_reservation-station-from').val()) disabled = false;\n    $('.js_reservation-button').attr('disabled', disabled);\n}\n\nfunction changeStationTo() {\n    var disabled = true;\n    if ($('.js_reservation-station-to').val() && $('.js_reservation-station-from').val()) disabled = false;\n    $('.js_reservation-button').attr('disabled', disabled);\n    setTimeout(clickButton, 300);\n}\n\nfunction changeDate() {\n    var val = $(this).data('val');\n    var $date = $(this).closest('form').find('.js_date-pick');\n    $(this).closest('form').find('.reservatButon').removeClass('active');\n    $(this).addClass('active');\n    $date.val(val);\n    $date.datepicker('setDate', val);\n    if ($(this).data('return')) {\n        reservationReturn();\n    } else {\n        showTours();\n    }\n    //setTimeout(clickButton2, 500);\n}\n\n$(document).on('change', '.js_date-pick', changeDatePicker);\n\nfunction changeDatePicker() {\n    var date = $(this).val();\n    var $bts = $(this).closest('form').find('.reservatButon');\n    $bts.removeClass('active');\n    var $btn = $bts.filter('[data-val=\"' + date + '\"]');\n    if ($btn.length) $btn.addClass('active');\n    //setTimeout(clickButton2, 500);\n}\n\nfunction disableDates() {\n    var fromCity = $(\"select[name='city_from_id']\").val();\n    var toCity = $(\"#city_to_id\").val();\n    if (toCity && fromCity) {\n        $('.js_date-pick').hide();\n        $('.js_fordate .js_bus-overlay').show();\n        $.get('/schedules/get_tour_dates', { city_from_id: fromCity, city_to_id: toCity }, function (array) {\n            var html = $('.js_fordate').html();\n            $('.js_fordate').html(html);\n            $('.js_date-pick').datepicker({\n                format: \"dd.mm.yyyy\",\n                todayHighlight: true,\n                autoclose: true,\n                language: 'ru',\n                beforeShowDay: function beforeShowDay(date) {\n                    var event = new Date(date);\n                    event.setDate(event.getDate() + 1);\n                    var dateDisable = JSON.stringify(event);\n                    dateDisable = dateDisable.slice(1, 11);\n                    return array.indexOf(dateDisable) !== -1;\n                }\n            });\n\n            if (array.length) {\n                var date1 = array[0];\n                date1 = date1.split('-');\n                $('.js_date-pick').datepicker('setDate', date1[2] + '.' + date1[1] + '.' + date1[0]);\n            }\n            $('.js_date-pick').show();\n            $('.js_fordate .js_bus-overlay').hide();\n        });\n    }\n    $.get('/schedules/get_tour_dates', { city_from_id: toCity, city_to_id: fromCity }, function (array) {\n        var html = $('.js_fordate2').html();\n        $('.js_fordate2').html(html);\n        $('.js_date-pick-return').datepicker({\n            format: \"dd.mm.yyyy\",\n            todayHighlight: true,\n            autoclose: true,\n            language: 'ru',\n            beforeShowDay: function beforeShowDay(date) {\n                var event = new Date(date);\n                event.setDate(event.getDate() + 1);\n                var dateDisable = JSON.stringify(event);\n                dateDisable = dateDisable.slice(1, 11);\n                return array.indexOf(dateDisable) !== -1;\n            }\n        });\n\n        if (array.length) {\n            var date1 = array[0];\n            date1 = date1.split('-');\n            $('.js_date-pick-return').datepicker('setDate', date1[2] + '.' + date1[1] + '.' + date1[0]);\n        }\n    });\n}\n\n},{}],4:[function(require,module,exports){\n'use strict';\n\n$(document).on('click', '.js_form-order-btn', orderForm);\n$(document).on('click', '.js_form-order-pay-btn', orderPayForm);\n$(document).on('click', '.js_form-coupon-btn', couponBtn);\n$('.js_orders-count_places_child').change(setChild);\n$(document).on('change', '.js_select_station_from', SelectOrderStationFrom);\n$(document).on('change', '.js_select_station_to', SelectOrderStationTo);\n$(document).on('change', '#country-codes', SelectCodeCountry);\n\n$(document).on('click', '.js_send-to-email', sendPDFEmail);\n$(document).on('click', '.js_submit-email', sendEmail);\n$(document).on('click', '.modal span.close', closePopup);\n\n$(document).on('ready', maskPhone);\n\nfunction maskPhone() {\n    var country = $('#country-codes option:selected').val();\n    switchCountry(country);\n}\n\nfunction switchCountry(country) {\n    switch (country) {\n        case \"ru\":\n            $(\".js_mask-phone\").inputmask(\"+7(999) 999-99-99\");\n            break;\n        case \"ua\":\n            $(\".js_mask-phone\").inputmask(\"+380(99) 999-99-99\");\n            break;\n        case \"by\":\n            $(\".js_mask-phone\").inputmask(\"+375(99) 999-99-99\");\n            break;\n        case \"de\":\n            $(\".js_mask-phone\").inputmask(\"+4\\\\9(999) 999-99-99\");\n            break;\n        case \"dee\":\n            $(\".js_mask-phone\").inputmask(\"+4\\\\9(999) 999-99-999\");\n            break;\n        case \"cz\":\n            $(\".js_mask-phone\").inputmask(\"+420(999) 999-99-99\");\n            break;\n        case \"il\":\n            $(\".js_mask-phone\").inputmask(\"+\\\\972(99) 999-99-99\");\n            break;\n        case \"us\":\n            $(\".js_mask-phone\").inputmask(\"+1(999) 999-99-99\");\n            break;\n        case \"fi\":\n            $(\".js_mask-phone\").inputmask(\"+358(99) 999-99-99\");\n            break;\n        case \"no\":\n            $(\".js_mask-phone\").inputmask(\"+47(999) 999-99-99\");\n            break;\n        case \"pl\":\n            $(\".js_mask-phone\").inputmask(\"+48(999) 999-99-99\");\n            break;\n        case \"uz\":\n            $(\".js_mask-phone\").inputmask(\"+\\\\9\\\\98(99) 999-99-99\");\n            break;\n        case \"tm\":\n            $(\".js_mask-phone\").inputmask(\"+\\\\9\\\\93(999) 999-99-99\");\n            break;\n        case \"md\":\n            $(\".js_mask-phone\").inputmask(\"+373(99) 999-99-99\");\n            break;\n        case \"az\":\n            $(\".js_mask-phone\").inputmask(\"+\\\\9\\\\94(99) 999-99-99\");\n            break;\n        case \"tj\":\n            $(\"#phone\").inputmask(\"+\\\\9\\\\92(9999) 9-99-99\");\n            break;\n        case \"fr\":\n            $(\"#phone\").inputmask(\"+33(999) 999-999\");\n            break;\n    }\n}\n\nfunction SelectCodeCountry() {\n    switchCountry($(this).val());\n}\n\nmaskPhone();\n\nfunction SelectOrderStationFrom() {\n    var data = {};\n    var url = $(this).data('url');\n    var returnTxt = $(this).data('return') ? '_return' : '';\n    data['station_from_id'] = $(this).val();\n    data['station_to_id'] = $(\"[name='station_to_id\" + returnTxt + \"']\").val();\n    data['destination'] = 'from';\n    data['return_ticket'] = $(this).data('return');\n    var is_return = data['return_ticket'] ? '.return-tickets' : '.direct-tickets';\n\n    $.get(url, data).success(function (data) {\n        if (data.result == 'error') {\n            toastr.error(data.message);\n            $(\"[name='station_from_id\" + returnTxt + \"']\").val(data.station_from_id);\n            $(\"[name='station_to_id\" + returnTxt + \"']\").val(data.station_to_id);\n        } else {\n            toastr.success(data.message);\n            $('.js_time_from' + returnTxt).html(data.DateFrom);\n            $('.js_time_to' + returnTxt).html(data.DateTo);\n            $('.js_order-prices' + is_return).html(data.htmlPrices);\n        }\n    });\n}\n\nfunction SelectOrderStationTo() {\n    var data = {};\n    var url = $(this).data('url');\n    var returnTxt = $(this).data('return') ? '_return' : '';\n    data['station_from_id'] = $(\"[name='station_from_id\" + returnTxt + \"']\").val();\n    data['station_to_id'] = $(this).val();\n    data['destination'] = 'to';\n    data['return_ticket'] = $(this).data('return');\n    var is_return = data['return_ticket'] ? '.return-tickets' : '.direct-tickets';\n\n    $.get(url, data).success(function (data) {\n        if (data.result == 'error') {\n            toastr.error(data.message);\n            $(\"[name='station_from_id\" + returnTxt + \"']\").val(data.station_from_id);\n            $(\"[name='station_to_id\" + returnTxt + \"']\").val(data.station_to_id);\n        } else {\n            toastr.success(data.message);\n            $('.js_time_from' + returnTxt).html(data.DateFrom);\n            $('.js_time_to' + returnTxt).html(data.DateTo);\n            $('.js_order-prices' + is_return).html(data.htmlPrices);\n        }\n    });\n}\n\nfunction couponBtn() {\n    var url = $(this).data('url');\n    var code = $('.js_form-coupon-code').val();\n    var $prices = $('.js_order-prices');\n    $.get(url + '?code=' + code, function (response) {\n        if (response.result == 'success') {\n            toastr.success(response.message);\n        } else {\n            toastr.error(response.message);\n        }\n        $prices.html(response.view);\n    });\n}\n\nfunction orderForm() {\n    var $form = $('.js_form-order');\n    $form.submit();\n    var fewSeconds = 5;\n    var btn = $(this);\n    btn.prop('disabled', true);\n    setTimeout(function () {\n        btn.prop('disabled', false);\n    }, fewSeconds * 1000);\n}\n\nfunction orderPayForm() {\n    $('<input>').attr({ type: 'hidden', id: 'is_pay', name: 'is_pay', value: 1 }).appendTo('form');\n    orderForm();\n}\n\nfunction setChild() {\n    var url = $(this).data('url');\n    var $prices = $('.js_order-prices');\n    var $total = $('#total-ticket');\n    var count = $(this).val();\n    $.get(url + '?count=' + count, function (response) {\n        if (response.result == 'success') {\n            toastr.success(response.message);\n        } else {\n            toastr.error(response.message);\n        }\n        $prices.html(response.view);\n        $total.html(response.total);\n    });\n}\n\nfunction closePopup() {\n    var $popup = $('#js_email-popup');\n    $popup.html('');\n}\n\nfunction sendPDFEmail() {\n    var id = $(this).attr('data-order-id');\n    var url = '/profile/generate-pdf-to-email/' + id;\n    var $popup = $('#js_email-popup');\n    var $this = this;\n\n    $(\"#js_ticket-active\").attr(\"data-ticket-id\", id);\n\n    var button_message_waiting = 'Обрабатывается...';\n    var button_message_again = 'Отправить еще раз?';\n\n    $($this).html(button_message_waiting);\n    $.get(url, function (response) {\n        if (response.result == 'success') {\n            toastr.success(response.message);\n        } else {\n            toastr.error(response.message);\n            $popup.html(response.view);\n            $('#popup1').show();\n        }\n        $($this).html(button_message_again);\n    });\n}\n\nfunction sendEmail() {\n\n    var url = '/profile/update/email';\n    var email = $('#settings-input').val();\n\n    $.post(url, {\n        email: email\n    }, function (data) {\n        if (data.result == 'error') {\n            toastr.error(data.message);\n        } else {\n            toastr.success('Данные успешно обновлены');\n            closePopup();\n            $(\".js_send-to-email\").trigger(\"click\");\n        }\n    });\n}\n\n},{}],5:[function(require,module,exports){\n'use strict';\n\n$(document).on('form-ajax-success', '.js_settings-form', submitSettingSuccess);\n$(document).on('click', '.js_settings-edit', editSetting);\n$(document).on('click', '.js_settings-save', saveSetting);\n$(document).on('click', '.js_tickets-cancel', ticketCancel);\n\nfunction ticketCancel() {\n    var orderId = $('.js_tickets-popup .techHiddenInput').val();\n    $.post('/profile/tickets', { id: orderId }, function (response) {\n        if (response.result == 'success') {\n            toastr.success(response.message);\n            $('.js_tickets-tr[data-id=' + orderId + ']').remove();\n        } else {\n            toastr.error(response.message);\n        }\n        $('.js_tickets-close_popup').click();\n    });\n}\n\nfunction saveSetting() {\n    $('.js_settings-form').submit();\n    return false;\n}\n\nfunction editSetting() {\n    $('.js_settings-edit').hide();\n    $('.js_settings-save').show();\n    $('.js_settings-form').find('.js_settings-input').attr('disabled', false);\n    return false;\n}\n\nfunction submitSettingSuccess() {\n    $('.js_settings-edit').show();\n    $('.js_settings-save').hide();\n    $('.js_settings-form').find('.js_settings-input').attr('disabled', true);\n}\n\n},{}],6:[function(require,module,exports){\n'use strict';\n\n$(document).on('click', '.js_get-bus', getBus);\n$(document).on('click', '.js_tour-disable-order', TourDisableOrder);\n$(document).on('click', '.seat:not(.reserved)', clickSeat);\n$(document).on('change', '.js_orders-count_places', clickSeat);\n$(document).on('click', '.js_form-places-btn', continueOrder);\n$(document).on('form-ajax', '.js_form-places', eventPlacesForm);\n\nfunction TourDisableOrder() {\n    $('html, body').animate({\n        scrollTop: $(\".blocksWrapper\").offset().top\n    }, 500);\n    var time = $(this).data('time');\n    toastr.warning('Бронирование на рейс за ' + time + ' мин до отправления недоступно через сайт, Вы можете забронировать билет с помощью оператора. Благодарим за понимание');\n}\n\nfunction eventPlacesForm(e, response) {\n    if (response.view) {\n        if (response.return_ticket) {\n            $('.scheduleBlockReturn .js_get-bus-row-bus:visible').html(response.view);\n        } else {\n            $('.scheduleBlock .js_get-bus-row-bus:visible').html(response.view);\n        }\n    }\n    $('.js_bus-overlay').hide();\n}\n\nfunction getBus() {\n    if (!$(this).hasClass('disabled')) {\n        var $getBus = $(this).closest('.shedule').find('.js_get-bus-row');\n        $getBus.addClass('disabled');\n        var url = $(this).data('url');\n        var $wrapper = $(this).closest('.sheduleRow').next('.js_get-bus-row');\n        if (!$wrapper.hasClass('active')) {\n            $getBus.removeClass('active').hide();\n            $.post(url, { return_ticket: $(this).data('return'), places: $(this).data('places') }, function (response) {\n                if (response.result == 'success') {\n                    $wrapper.show();\n                    $wrapper.addClass('active');\n                    $wrapper.find('.js_get-bus-row-bus').html(response.view);\n                    $wrapper.find('.js_orders-count_places').trigger('change');\n                    // $wrapper.find('.js_bus-wrap').height($wrapper.find('.js_get-bus-row-bus').width() - 150)\n                } else {\n                    toastr.error(response.message);\n                }\n                $getBus.removeClass('disabled');\n            });\n        } else {\n            $wrapper.removeClass('active').hide();\n            $getBus.removeClass('disabled');\n        }\n    }\n    return false;\n}\n\nfunction continueOrder() {\n    if ($('#return_flag > option:selected').val() == 1) {\n        var places = $('.scheduleBlock .js_get-bus-row-bus .cell.active:visible').length + parseInt($('.scheduleBlock .js_orders-count_places').val() || 0); // Кол-во мест туда\n        var places2 = $('.scheduleBlockReturn .js_get-bus-row-bus .cell.active:visible').length + parseInt($('.scheduleBlockReturn .js_orders-count_places').val() || 0); // Кол-во мест обратно\n        if (places !== places2) {\n            toastr.error('Количество мест туда и обратно должны совпадать!');\n            return false;\n        }\n        if (places == 0) {\n            toastr.error('Выберите места!');\n            return false;\n        }\n    }\n    clickSeat(true, $(this));\n}\n\nfunction clickSeat(order, $this) {\n    $('.js_bus-overlay').show();\n    $this = $this ? $this : $(this);\n    var $wrapper = $this.closest('.js_get-bus-row');\n    var $form = $wrapper.find('.js_form-places');\n    var $wrapperInput = $form.find('.js_form-places-inputs');\n    $wrapperInput.html('');\n    $wrapperInput.prepend('<input type=\"hidden\" name=\"return_ticket\" value=\"' + $this.closest('.shedulePage').parent().find('.return-form').eq(0).val() + '\"/>');\n    var $countPlaces = $wrapper.find('.js_orders-count_places');\n\n    if ($countPlaces.length) {\n        var val = $countPlaces.val();\n        for (var $i = 0; $i < val; $i++) {\n            $wrapperInput.prepend('<input type=\"hidden\" name=\"places[]\" value=\"\"/>');\n        }\n    } else {\n        if (parseInt(cnt_reserved_places_tour) >= parseInt(limit_order_by_place) && $(this).hasClass('active') !== true && order !== true) {\n            toastr.error(\"Бронирование ограничено\");\n        } else $(this).toggleClass('active');\n\n        $wrapper.find('.seat.active:not(.reserved)').each(function () {\n            var number = $(this).data('number');\n            $wrapperInput.prepend('<input type=\"hidden\" name=\"places[]\" value=\"' + number + '\"/>');\n        });\n    }\n    if (order === true) $form.addClass('js_form-step-order');\n    $form.submit();\n    return false;\n}\n\n},{}]},{},[1]);\n"],"file":"app.js"}